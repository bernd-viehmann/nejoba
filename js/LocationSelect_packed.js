var map, markers; OpenLayers.Control.Click = OpenLayers.Class(OpenLayers.Control, { defaultHandlerOptions: { single: !0, "double": !1, pixelTolerance: 0, stopSingle: !1, stopDouble: !1 }, initialize: function (a) { this.handlerOptions = OpenLayers.Util.extend({}, this.defaultHandlerOptions); OpenLayers.Control.prototype.initialize.apply(this, arguments); this.handler = new OpenLayers.Handler.Click(this, { click: this.trigger }, this.handlerOptions) }, trigger: function (a) { var d = map.getLonLatFromPixel(a.xy); a = map.getLonLatFromPixel(a.xy).transform(new OpenLayers.Projection("EPSG:900913"), new OpenLayers.Projection("EPSG:4326")); $("#CoPlaBottom_txbx_lat").val(a.lat); $("#CoPlaBottom_txbx_lon").val(a.lon); a = new OpenLayers.Size(21, 25); var c = new OpenLayers.Pixel(-(a.w / 2), -a.h); a = new OpenLayers.Icon("http://www.openlayers.org/dev/img/marker.png", a, c); c = map.getLayersByName("Markers")[0]; c.clearMarkers(); c.addMarker(new OpenLayers.Marker(new OpenLayers.LonLat(d.lon, d.lat), a)) } }); function initMap() { function a() { map.getLayersByName("Markers")[0].clearMarkers(); $("#CoPlaBottom_txbx_lat").val(""); $("#CoPlaBottom_txbx_lon").val(""); var a = prepNoatim(); $.getJSON(a, function (a) { "undefined" === typeof a[0] ? (a = (new OpenLayers.LonLat(10.159, 51.48)).transform(d, c), map.setCenter(a), map.zoomTo(6), $("#CoPlaBottom_txbx_street").val("unbekannt !")) : (a = (new OpenLayers.LonLat(a[0].lon, a[0].lat)).transform(d, c), map.setCenter(a), map.zoomTo(16)) }) } map = new OpenLayers.Map("map"); var d = new OpenLayers.Projection("EPSG:4326"), c = new OpenLayers.Projection("EPSG:900913"), b = new OpenLayers.Layer.OSM("Street Map"); map.addLayers([b]); markers = new OpenLayers.Layer.Markers("Markers"); map.addLayer(markers); b = (new OpenLayers.LonLat(10.159, 51.48)).transform(d, c); map.setCenter(b); map.zoomTo(6); b = new OpenLayers.Control.Click; map.addControl(b); b.activate(); $("#CoPlaBottom_img_findLocation").click(function (c) { a() }); $("#CoPlaBottom_img_centerMap").click(function (a) { a = $("#CoPlaBottom_txbx_lat").val(); var b = $("#CoPlaBottom_txbx_lon").val(); a = parseFloat(a); isNaN(a) ? alert("L\u00e4ngengrad ist nicht korrekt! Der Punkt '.' dient als Dezimaltrenner.") : (b = parseFloat(b), isNaN(b) ? alert("Breitengrad ist nicht korrekt! Der Punkt '.' dient als Dezimaltrenner.") : (a = (new OpenLayers.LonLat(b, a)).transform(d, c), map.setCenter(a), map.zoomTo(16))) }); a() } function prepNoatim() { var a = "http://nominatim.openstreetmap.org/search?q=+@@STREET@@,+@@POSTCODE@@,+@@COUNTRYCODE@@&format=json&polygon=1&addressdetails=1", d = $("#CoPlaBottom_txbx_street").val(), c = $("#CoPlaBottom_lbl_countrycode").text(), b = $("#CoPlaBottom_sel_lctn :selected").text(), a = a.replace("@@STREET@@", d), a = a.replace("@@POSTCODE@@", b); return a = a.replace("@@COUNTRYCODE@@", c) };